package info.nukoneko.android.ho_n.controller.main.twitter;import android.support.annotation.NonNull;import android.support.v4.app.Fragment;import android.support.v4.app.FragmentManager;import android.support.v4.app.FragmentPagerAdapter;import java.util.ArrayList;import java.util.List;import info.nukoneko.android.ho_n.controller.main.twitter.tab.NKTweetTabFragmentAbstract;import rx.Observable;import twitter4j.User;/** * Created by atsumi on 2016/10/21. */public final class NKTwitterTabPagerAdapter extends FragmentPagerAdapter {    private ArrayList<NKTweetTabFragmentAbstract> fragments = new ArrayList<>();    public NKTwitterTabPagerAdapter(FragmentManager fm) {        super(fm);    }    @Override    public Fragment getItem(int position) {        return fragments.get(position);    }    @Override    public int getCount() {        return fragments.size();    }    @Override    public CharSequence getPageTitle(int position) {        NKTweetTabFragmentAbstract fragment = fragments.get(position);        User user = fragment.getUser();        return String.format("%s - %s", (user == null ?                "":                user.getName()), fragment.getListType().name());    }    public <T extends NKTweetTabFragmentAbstract> boolean addFragment(long userId, @NonNull Class<T> clazz) {        T fragment = null;        try {            fragment = clazz.newInstance();            fragment.setArguments(fragment.getBundleOption(userId));        } catch (InstantiationException e) {            e.printStackTrace();        } catch (IllegalAccessException e) {            e.printStackTrace();        }        if (fragment == null) {            return false;        }        T finalFragment = fragment;        List<NKTweetTabFragmentAbstract> list = Observable                .from(fragments)                .filter(f -> f.getManagingUserId() == userId)                .filter(f -> f.getListType() == finalFragment.getListType()).toList().toBlocking().single();        if (list.size() > 0) return false;        fragments.add(fragment);        this.notifyDataSetChanged();        return true;    }}